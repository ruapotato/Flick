<?xml version="1.0" encoding="UTF-8"?>
<protocol name="android_wlegl">
  <copyright>
    Copyright (C) 2013-2023 libhybris

    Licensed under the Apache License, Version 2.0
  </copyright>

  <interface name="android_wlegl" version="2">
    <description summary="Interface for Android EGL buffer sharing">
      This interface allows clients using libhybris to share Android gralloc
      buffers with the Wayland compositor for hardware-accelerated rendering.
    </description>

    <enum name="error">
      <entry name="bad_handle" value="0" summary="invalid native handle"/>
      <entry name="bad_value" value="1" summary="invalid value"/>
    </enum>

    <request name="create_handle">
      <description summary="Create a native buffer handle">
        Creates a handle object that can receive file descriptors and integers
        representing an Android native buffer handle.
      </description>
      <arg name="id" type="new_id" interface="android_wlegl_handle"/>
      <arg name="num_fds" type="int" summary="number of file descriptors"/>
      <arg name="num_ints" type="int" summary="number of integers"/>
    </request>

    <request name="create_buffer">
      <description summary="Create a wl_buffer from a native handle">
        Creates a wl_buffer object from an Android native buffer handle.
        The handle must have been filled with the appropriate file descriptors
        and integers before calling this request.
      </description>
      <arg name="id" type="new_id" interface="wl_buffer"/>
      <arg name="width" type="int" summary="buffer width"/>
      <arg name="height" type="int" summary="buffer height"/>
      <arg name="stride" type="int" summary="buffer stride in bytes"/>
      <arg name="format" type="int" summary="HAL pixel format"/>
      <arg name="usage" type="int" summary="gralloc usage flags"/>
      <arg name="native_handle" type="object" interface="android_wlegl_handle" summary="native buffer handle"/>
    </request>

    <event name="format">
      <description summary="Supported pixel format">
        Sent to advertise a supported HAL pixel format.
      </description>
      <arg name="format" type="int" summary="HAL pixel format"/>
    </event>
  </interface>

  <interface name="android_wlegl_handle" version="1">
    <description summary="Native buffer handle">
      Represents an Android native_handle_t structure, which contains
      file descriptors and integer data describing a gralloc buffer.
    </description>

    <enum name="error">
      <entry name="too_many_fds" value="0" summary="too many file descriptors"/>
    </enum>

    <request name="add_fd">
      <description summary="Add a file descriptor to the handle">
        Adds a file descriptor to the native handle. Must be called
        before create_buffer for each fd in the handle.
      </description>
      <arg name="fd" type="fd" summary="file descriptor"/>
    </request>

    <request name="add_int">
      <description summary="Add an integer to the handle">
        Adds an integer value to the native handle data array.
      </description>
      <arg name="value" type="int" summary="integer value"/>
    </request>

    <request name="destroy" type="destructor">
      <description summary="Destroy the handle">
        Destroys the handle object and releases associated resources.
      </description>
    </request>
  </interface>
</protocol>
