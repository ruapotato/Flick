// Flick Shell UI - Mobile-first Linux shell
// Uses Slint declarative UI with Material Design inspired styling

import { Button, VerticalBox, HorizontalBox, GridBox, ScrollView, Slider } from "std-widgets.slint";

// Color scheme - dark mobile theme
global Theme {
    out property <color> background: #0a0a0f;
    out property <color> surface: #1a1a24;
    out property <color> surface-variant: #252532;
    out property <color> primary: #4a9eff;
    out property <color> primary-container: #1a3a5c;
    out property <color> on-surface: #ffffff;
    out property <color> on-surface-variant: #a0a0b0;
    out property <color> error: #ff6b6b;
    out property <color> success: #4ade80;
}

// App category for home screen
export struct AppCategory {
    name: string,
    icon: string,
    color: color,
}

// Status bar at top of screen
component StatusBar inherits Rectangle {
    in property <string> time: "12:00";
    in property <int> battery: 85;
    in property <bool> wifi: true;

    height: 48px;
    background: transparent;

    HorizontalLayout {
        padding-left: 16px;
        padding-right: 16px;
        spacing: 8px;

        // Time (left)
        Text {
            text: time;
            color: Theme.on-surface;
            font-size: 16px;
            font-weight: 600;
            vertical-alignment: center;
        }

        Rectangle { horizontal-stretch: 1; }

        // Status icons (right)
        HorizontalLayout {
            spacing: 12px;

            // WiFi indicator
            Text {
                text: wifi ? "W" : "-";
                color: wifi ? Theme.primary : Theme.on-surface-variant;
                font-size: 14px;
                vertical-alignment: center;
            }

            // Battery
            Text {
                text: battery + "%";
                color: battery > 20 ? Theme.success : Theme.error;
                font-size: 14px;
                vertical-alignment: center;
            }
        }
    }
}

// Home indicator at bottom
component HomeIndicator inherits Rectangle {
    height: 34px;
    background: transparent;

    Rectangle {
        x: (parent.width - self.width) / 2;
        y: 8px;
        width: 134px;
        height: 5px;
        border-radius: 2.5px;
        background: Theme.on-surface-variant.with-alpha(0.5);
    }
}

// App tile for home screen grid
component AppTile inherits Rectangle {
    in property <string> name: "App";
    in property <string> icon: "A";
    in property <color> tile-color: Theme.primary;

    callback clicked();

    width: 100%;
    height: 100%;
    // Visual feedback when pressed
    background: touch-area.pressed ? Theme.surface-variant.with-alpha(0.3) : transparent;

    VerticalLayout {
        alignment: center;
        spacing: 10px;

        // Icon row - centered
        HorizontalLayout {
            alignment: center;

            Rectangle {
                width: 80px;
                height: 80px;
                border-radius: 20px;
                background: tile-color;

                Text {
                    width: 100%;
                    height: 100%;
                    text: icon;
                    color: Theme.on-surface;
                    font-size: 36px;
                    font-weight: 700;
                    horizontal-alignment: center;
                    vertical-alignment: center;
                }
            }
        }

        // Name row - centered
        HorizontalLayout {
            alignment: center;

            Text {
                text: name;
                color: Theme.on-surface-variant;
                font-size: 14px;
                horizontal-alignment: center;
                overflow: elide;
            }
        }
    }

    // TouchArea with explicit size - named so we can reference pressed state
    touch-area := TouchArea {
        width: 100%;
        height: 100%;
        clicked => { root.clicked(); }
    }
}

// Quick toggle button
component QuickToggle inherits Rectangle {
    in property <string> label: "Toggle";
    in property <string> icon: "T";
    in property <bool> enabled: false;

    callback toggled();

    width: 80px;
    height: 80px;
    border-radius: 16px;
    background: enabled ? Theme.primary : Theme.surface-variant;

    VerticalLayout {
        alignment: center;
        spacing: 4px;

        Text {
            text: icon;
            color: Theme.on-surface;
            font-size: 24px;
            font-weight: 600;
            horizontal-alignment: center;
        }

        Text {
            text: label;
            color: Theme.on-surface.with-alpha(0.8);
            font-size: 10px;
            horizontal-alignment: center;
        }
    }

    TouchArea {
        clicked => { root.toggled(); }
    }
}

// PIN button
component PinButton inherits Rectangle {
    in property <string> digit: "0";
    callback clicked();

    width: 72px;
    height: 72px;
    border-radius: 36px;
    background: touch.pressed ? Theme.primary : Theme.surface-variant;

    Text {
        width: 100%;
        height: 100%;
        text: digit;
        color: Theme.on-surface;
        font-size: 28px;
        font-weight: 500;
        horizontal-alignment: center;
        vertical-alignment: center;
    }

    touch := TouchArea {
        clicked => { root.clicked(); }
    }
}

// PIN pad for lock screen
component PinPad inherits Rectangle {
    callback digit-pressed(string);
    callback backspace-pressed();

    width: 280px;
    height: 320px;

    GridLayout {
        spacing: 16px;
        padding: 16px;

        Row {
            PinButton { digit: "1"; clicked => { digit-pressed("1"); } }
            PinButton { digit: "2"; clicked => { digit-pressed("2"); } }
            PinButton { digit: "3"; clicked => { digit-pressed("3"); } }
        }
        Row {
            PinButton { digit: "4"; clicked => { digit-pressed("4"); } }
            PinButton { digit: "5"; clicked => { digit-pressed("5"); } }
            PinButton { digit: "6"; clicked => { digit-pressed("6"); } }
        }
        Row {
            PinButton { digit: "7"; clicked => { digit-pressed("7"); } }
            PinButton { digit: "8"; clicked => { digit-pressed("8"); } }
            PinButton { digit: "9"; clicked => { digit-pressed("9"); } }
        }
        Row {
            Rectangle { width: 72px; height: 72px; background: transparent; }
            PinButton { digit: "0"; clicked => { digit-pressed("0"); } }
            PinButton { digit: "<"; clicked => { backspace-pressed(); } }
        }
    }
}

// Lock screen view - fills entire screen
component LockScreen inherits Rectangle {
    in property <string> time: "12:00";
    in property <string> date: "Saturday, December 7";
    in property <int> pin-length: 0;
    in property <string> error-message: "";

    callback digit-pressed(string);
    callback backspace-pressed();

    width: 100%;
    height: 100%;
    background: Theme.background;

    VerticalLayout {
        alignment: center;
        spacing: 24px;
        padding: 32px;

        // Time display
        Text {
            text: time;
            color: Theme.on-surface;
            font-size: 72px;
            font-weight: 300;
            horizontal-alignment: center;
        }

        // Date
        Text {
            text: date;
            color: Theme.on-surface-variant;
            font-size: 18px;
            horizontal-alignment: center;
        }

        Rectangle { height: 32px; }

        // PIN dots
        HorizontalLayout {
            alignment: center;
            spacing: 16px;

            for i in 6: Rectangle {
                width: 16px;
                height: 16px;
                border-radius: 8px;
                background: i < pin-length ? Theme.primary : Theme.surface-variant;
            }
        }

        // Error message
        if error-message != "": Text {
            text: error-message;
            color: Theme.error;
            font-size: 14px;
            horizontal-alignment: center;
        }

        Rectangle { height: 16px; }

        // PIN pad - centered
        HorizontalLayout {
            alignment: center;
            PinPad {
                digit-pressed(d) => { root.digit-pressed(d); }
                backspace-pressed => { root.backspace-pressed(); }
            }
        }
    }
}

// Home screen with app grid - 4 columns, flexible layout
component HomeScreen inherits Rectangle {
    in property <[AppCategory]> categories: [];
    in property <string> time: "12:00";
    in property <int> battery: 85;

    callback app-tapped(int);

    width: 100%;
    height: 100%;
    background: Theme.background;

    VerticalLayout {
        StatusBar {
            time: root.time;
            battery: root.battery;
            wifi: true;
        }

        // App grid area - fills remaining space
        Rectangle {
            vertical-stretch: 1;
            background: Theme.background;

            VerticalLayout {
                padding: 24px;
                spacing: 16px;
                alignment: start;

                // Row 0 (items 0-3)
                if categories.length > 0: HorizontalLayout {
                    spacing: 12px;
                    height: 140px;

                    Rectangle {
                        horizontal-stretch: 1;
                        if categories.length > 0: AppTile {
                            name: categories[0].name;
                            icon: categories[0].icon;
                            tile-color: categories[0].color;
                            clicked => { app-tapped(0); }
                        }
                    }
                    Rectangle {
                        horizontal-stretch: 1;
                        if categories.length > 1: AppTile {
                            name: categories[1].name;
                            icon: categories[1].icon;
                            tile-color: categories[1].color;
                            clicked => { app-tapped(1); }
                        }
                    }
                    Rectangle {
                        horizontal-stretch: 1;
                        if categories.length > 2: AppTile {
                            name: categories[2].name;
                            icon: categories[2].icon;
                            tile-color: categories[2].color;
                            clicked => { app-tapped(2); }
                        }
                    }
                    Rectangle {
                        horizontal-stretch: 1;
                        if categories.length > 3: AppTile {
                            name: categories[3].name;
                            icon: categories[3].icon;
                            tile-color: categories[3].color;
                            clicked => { app-tapped(3); }
                        }
                    }
                }

                // Row 1 (items 4-7)
                if categories.length > 4: HorizontalLayout {
                    spacing: 12px;
                    height: 140px;

                    Rectangle {
                        horizontal-stretch: 1;
                        if categories.length > 4: AppTile {
                            name: categories[4].name;
                            icon: categories[4].icon;
                            tile-color: categories[4].color;
                            clicked => { app-tapped(4); }
                        }
                    }
                    Rectangle {
                        horizontal-stretch: 1;
                        if categories.length > 5: AppTile {
                            name: categories[5].name;
                            icon: categories[5].icon;
                            tile-color: categories[5].color;
                            clicked => { app-tapped(5); }
                        }
                    }
                    Rectangle {
                        horizontal-stretch: 1;
                        if categories.length > 6: AppTile {
                            name: categories[6].name;
                            icon: categories[6].icon;
                            tile-color: categories[6].color;
                            clicked => { app-tapped(6); }
                        }
                    }
                    Rectangle {
                        horizontal-stretch: 1;
                        if categories.length > 7: AppTile {
                            name: categories[7].name;
                            icon: categories[7].icon;
                            tile-color: categories[7].color;
                            clicked => { app-tapped(7); }
                        }
                    }
                }

                // Row 2 (items 8-11)
                if categories.length > 8: HorizontalLayout {
                    spacing: 12px;
                    height: 140px;

                    Rectangle {
                        horizontal-stretch: 1;
                        if categories.length > 8: AppTile {
                            name: categories[8].name;
                            icon: categories[8].icon;
                            tile-color: categories[8].color;
                            clicked => { app-tapped(8); }
                        }
                    }
                    Rectangle {
                        horizontal-stretch: 1;
                        if categories.length > 9: AppTile {
                            name: categories[9].name;
                            icon: categories[9].icon;
                            tile-color: categories[9].color;
                            clicked => { app-tapped(9); }
                        }
                    }
                    Rectangle {
                        horizontal-stretch: 1;
                        if categories.length > 10: AppTile {
                            name: categories[10].name;
                            icon: categories[10].icon;
                            tile-color: categories[10].color;
                            clicked => { app-tapped(10); }
                        }
                    }
                    Rectangle {
                        horizontal-stretch: 1;
                        if categories.length > 11: AppTile {
                            name: categories[11].name;
                            icon: categories[11].icon;
                            tile-color: categories[11].color;
                            clicked => { app-tapped(11); }
                        }
                    }
                }

                // Row 3 (items 12-15)
                if categories.length > 12: HorizontalLayout {
                    spacing: 12px;
                    height: 140px;

                    Rectangle {
                        horizontal-stretch: 1;
                        if categories.length > 12: AppTile {
                            name: categories[12].name;
                            icon: categories[12].icon;
                            tile-color: categories[12].color;
                            clicked => { app-tapped(12); }
                        }
                    }
                    Rectangle {
                        horizontal-stretch: 1;
                        if categories.length > 13: AppTile {
                            name: categories[13].name;
                            icon: categories[13].icon;
                            tile-color: categories[13].color;
                            clicked => { app-tapped(13); }
                        }
                    }
                    Rectangle {
                        horizontal-stretch: 1;
                        if categories.length > 14: AppTile {
                            name: categories[14].name;
                            icon: categories[14].icon;
                            tile-color: categories[14].color;
                            clicked => { app-tapped(14); }
                        }
                    }
                    Rectangle {
                        horizontal-stretch: 1;
                        if categories.length > 15: AppTile {
                            name: categories[15].name;
                            icon: categories[15].icon;
                            tile-color: categories[15].color;
                            clicked => { app-tapped(15); }
                        }
                    }
                }

                // Spacer at bottom
                Rectangle { vertical-stretch: 1; }
            }
        }

        HomeIndicator {}
    }
}

// Quick settings panel
component QuickSettingsPanel inherits Rectangle {
    in property <float> brightness: 0.7;
    in property <bool> wifi-enabled: true;
    in property <bool> bluetooth-enabled: false;
    in property <string> wifi-ssid: "Home WiFi";
    in property <int> battery-percent: 85;
    in property <string> time: "12:00";

    callback brightness-changed(float);
    callback wifi-toggled();
    callback bluetooth-toggled();
    callback lock-pressed();

    width: 100%;
    height: 100%;
    background: Theme.background;

    VerticalLayout {
        // Header with time and status
        Rectangle {
            height: 80px;
            background: Theme.primary-container;

            HorizontalLayout {
                padding: 20px;
                spacing: 16px;

                Text {
                    text: time;
                    color: Theme.on-surface;
                    font-size: 36px;
                    font-weight: 300;
                    vertical-alignment: center;
                }

                Rectangle { horizontal-stretch: 1; }

                VerticalLayout {
                    alignment: center;
                    spacing: 4px;

                    Text {
                        text: wifi-ssid;
                        color: Theme.primary;
                        font-size: 14px;
                        horizontal-alignment: right;
                    }

                    Text {
                        text: battery-percent + "% Battery";
                        color: battery-percent > 20 ? Theme.success : Theme.error;
                        font-size: 12px;
                        horizontal-alignment: right;
                    }
                }
            }
        }

        // Quick toggles section
        Rectangle {
            height: 140px;
            background: Theme.surface;

            VerticalLayout {
                padding: 16px;
                spacing: 12px;

                Text {
                    text: "Quick Settings";
                    color: Theme.on-surface-variant;
                    font-size: 12px;
                    font-weight: 600;
                }

                HorizontalLayout {
                    spacing: 16px;
                    alignment: center;

                    QuickToggle {
                        label: "WiFi";
                        icon: "W";
                        enabled: wifi-enabled;
                        toggled => { wifi-toggled(); }
                    }

                    QuickToggle {
                        label: "BT";
                        icon: "B";
                        enabled: bluetooth-enabled;
                        toggled => { bluetooth-toggled(); }
                    }

                    QuickToggle {
                        label: "Lock";
                        icon: "L";
                        enabled: false;
                        toggled => { lock-pressed(); }
                    }
                }
            }
        }

        // Brightness slider
        Rectangle {
            height: 100px;
            background: Theme.surface;

            VerticalLayout {
                padding: 16px;
                spacing: 12px;

                Text {
                    text: "Brightness";
                    color: Theme.on-surface-variant;
                    font-size: 12px;
                    font-weight: 600;
                }

                HorizontalLayout {
                    spacing: 12px;
                    padding-left: 8px;
                    padding-right: 8px;

                    Text {
                        text: "O";
                        color: Theme.on-surface-variant;
                        font-size: 16px;
                        vertical-alignment: center;
                    }

                    Slider {
                        horizontal-stretch: 1;
                        minimum: 0;
                        maximum: 100;
                        value: brightness * 100;
                        changed(v) => { brightness-changed(v / 100); }
                    }

                    Text {
                        text: "O";
                        color: Theme.on-surface;
                        font-size: 20px;
                        vertical-alignment: center;
                    }
                }
            }
        }

        // Spacer
        Rectangle {
            vertical-stretch: 1;
            background: Theme.background;
        }

        HomeIndicator {}
    }
}

// Main shell component
export component FlickShell inherits Window {
    in property <string> current-view: "lock"; // "lock", "home", "quick-settings"
    in property <[AppCategory]> categories: [];
    in property <string> lock-time: "12:00";
    in property <string> lock-date: "Saturday, December 7";
    in property <int> pin-length: 0;
    in property <string> lock-error: "";
    in property <float> brightness: 0.7;
    in property <bool> wifi-enabled: true;
    in property <bool> bluetooth-enabled: false;
    in property <string> wifi-ssid: "WiFi";
    in property <int> battery-percent: 85;

    callback pin-digit-pressed(string);
    callback pin-backspace-pressed();
    callback pin-enter-pressed();
    callback app-tapped(int);
    callback app-long-pressed(int);
    callback brightness-changed(float);
    callback wifi-toggled();
    callback bluetooth-toggled();
    callback lock-pressed();

    title: "Flick Shell";
    background: Theme.background;

    // Lock screen - fills entire window
    if current-view == "lock": LockScreen {
        width: 100%;
        height: 100%;
        time: lock-time;
        date: lock-date;
        pin-length: pin-length;
        error-message: lock-error;
        digit-pressed(d) => { pin-digit-pressed(d); }
        backspace-pressed => { pin-backspace-pressed(); }
    }

    // Home screen - fills entire window
    if current-view == "home": HomeScreen {
        width: 100%;
        height: 100%;
        categories: categories;
        time: lock-time;
        battery: battery-percent;
        app-tapped(i) => { app-tapped(i); }
    }

    // Quick settings - fills entire window
    if current-view == "quick-settings": QuickSettingsPanel {
        width: 100%;
        height: 100%;
        brightness: brightness;
        wifi-enabled: wifi-enabled;
        bluetooth-enabled: bluetooth-enabled;
        wifi-ssid: wifi-ssid;
        battery-percent: battery-percent;
        time: lock-time;
        brightness-changed(v) => { brightness-changed(v); }
        wifi-toggled => { wifi-toggled(); }
        bluetooth-toggled => { bluetooth-toggled(); }
        lock-pressed => { lock-pressed(); }
    }
}
