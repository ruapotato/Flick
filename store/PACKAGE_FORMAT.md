# Flick Package Format (.flick) Specification

Version 1.0

## Overview

A `.flick` package is a ZIP archive containing a QML-based application along with its metadata and dependencies. The format is designed to be simple, secure, and easy to distribute.

## File Structure

```
myapp.flick (ZIP archive)
├── manifest.json          # Package metadata (required)
├── app/                   # Application files (required)
│   ├── main.qml          # Entry point (required)
│   ├── *.qml             # Additional QML files
│   └── resources/        # Images, sounds, etc.
├── icon.png              # App icon 256x256 (required)
├── screenshots/          # Screenshots for store (optional)
│   ├── 1.png
│   └── 2.png
└── build/                # For compiled apps (optional)
    ├── Cargo.toml        # Rust project file
    ├── src/              # Rust source code
    └── binary            # Pre-compiled binary (optional)
```

## manifest.json Schema

```json
{
  "format_version": 1,
  "id": "com.example.myapp",
  "name": "My App",
  "version": "1.0.0",
  "description": "A brief description of the app",
  "long_description": "A longer description with features...",
  "author": {
    "name": "Author Name",
    "email": "author@example.com",
    "url": "https://example.com"
  },
  "license": "AGPL-3.0",
  "categories": ["Utility", "Productivity"],
  "keywords": ["keyword1", "keyword2"],
  "homepage": "https://example.com/myapp",
  "repository": "https://github.com/example/myapp",

  "app": {
    "type": "qml",
    "entry": "main.qml",
    "min_flick_version": "1.0.0"
  },

  "dependencies": {
    "apt": [
      "libqt5multimedia5",
      "qml-module-qtmultimedia"
    ],
    "pip": {
      "enabled": false,
      "packages": [],
      "python_version": "3.11"
    }
  },

  "build": {
    "type": "none",
    "commands": []
  },

  "permissions": [
    "audio",
    "files:read:~/Music",
    "network:local"
  ],

  "ai_generated": {
    "is_ai_generated": false,
    "generator_version": "",
    "original_prompt": "",
    "generation_date": ""
  },

  "store": {
    "maturity_rating": "everyone",
    "price": "free",
    "testing_status": "stable"
  }
}
```

## App Types

### 1. QML Apps (type: "qml")
Standard Qt/QML applications. Most apps will be this type.

```json
{
  "app": {
    "type": "qml",
    "entry": "main.qml"
  }
}
```

### 2. Rust Apps (type: "rust")
Compiled Rust applications (like Sandbox).

```json
{
  "app": {
    "type": "rust",
    "entry": "flick-sandbox",
    "cargo_features": []
  },
  "build": {
    "type": "cargo",
    "commands": ["cargo build --release"]
  }
}
```

### 3. Hybrid Apps (type: "hybrid")
QML frontend with compiled backend.

```json
{
  "app": {
    "type": "hybrid",
    "qml_entry": "main.qml",
    "binary_entry": "backend"
  }
}
```

## Dependencies

### APT Packages
System packages installed via apt:

```json
{
  "dependencies": {
    "apt": [
      "libsdl2-dev",
      "ffmpeg"
    ]
  }
}
```

### Python/Pip Packages
Python packages with isolated virtual environment:

```json
{
  "dependencies": {
    "pip": {
      "enabled": true,
      "packages": [
        "requests==2.31.0",
        "beautifulsoup4>=4.12.0"
      ],
      "python_version": "3.11",
      "requirements_file": "requirements.txt"
    }
  }
}
```

## Permissions

Apps must declare required permissions:

| Permission | Description |
|------------|-------------|
| `audio` | Access audio playback/recording |
| `camera` | Access camera |
| `network:local` | Local network access |
| `network:internet` | Internet access |
| `files:read:<path>` | Read access to path |
| `files:write:<path>` | Write access to path |
| `location` | GPS/location access |
| `phone` | Phone call access |
| `sms` | SMS access |
| `contacts` | Contacts access |
| `notifications` | Show notifications |
| `background` | Run in background |

## AI-Generated App Metadata

For apps generated by the Flick Store AI system:

```json
{
  "ai_generated": {
    "is_ai_generated": true,
    "generator_version": "claude-code-1.0",
    "original_prompt": "Create a todo list app with dark theme",
    "generation_date": "2026-01-01T10:00:00Z",
    "human_reviewed": false,
    "review_notes": ""
  }
}
```

## Store Metadata

```json
{
  "store": {
    "maturity_rating": "everyone|teen|mature",
    "price": "free|0.99|...",
    "testing_status": "wild_west|testing|stable",
    "featured": false,
    "downloads": 0,
    "rating": 0.0
  }
}
```

## Installation Process

1. **Download** - Package downloaded from store
2. **Verify** - Check package signature and manifest
3. **Extract** - Unzip to `~/.local/share/flick/apps/<app_id>/`
4. **Dependencies** - Install apt/pip dependencies
5. **Build** - Run build commands if needed
6. **Register** - Create .desktop file and register with shell
7. **Notify** - Inform shell of new app

## Security Considerations

1. **Sandboxing** - Apps run with limited permissions
2. **Signature Verification** - Packages signed by store
3. **Dependency Audit** - Dependencies checked against blocklist
4. **AI Safety Review** - AI-generated apps go through multi-level review
5. **User Consent** - Users approve permissions before install

## File Size Limits

- Maximum package size: 100MB
- Maximum icon size: 1MB
- Maximum screenshot size: 2MB each
- Maximum 5 screenshots

## Version Numbering

Follow semantic versioning: MAJOR.MINOR.PATCH

- MAJOR: Breaking changes
- MINOR: New features, backwards compatible
- PATCH: Bug fixes

## License

All apps distributed through the Flick Store must be AGPL-3.0 licensed.
Users agree to this when submitting prompts for AI-generated apps.
